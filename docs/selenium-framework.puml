@startuml SeleniumFramework
skinparam classAttributeIconSize 0
skinparam dpi 150
skinparam shadowing false
skinparam linetype ortho
skinparam defaultFontName Arial

title Selenium/TestNG Automation Framework - Class Diagram

package "Tests" {
  class TestBase {
    + setUpClass(browser)
    + setUpMethod()
    + tearDownMethod(result)
    + tearDownClass()
  }

  class TC01AgodaHotelSearch {
    + TC01_SearchAndSortHotelSuccessfully(destination, rooms, adults, children, expectedHotelCount)
  }
}

package "Pages" {
  class BasePage {
    # reporter : ITestReporter
    # findElement(By) : WebElement
    # findElements(By) : List<WebElement>
    # waitForElementVisible(Element)
    # clickElement(Element)
    # enterText(Element, String)
  }

  class AgodaHomePage {
    + navigateToHomePage()
    + enterDestination(destination)
    + selectDestinationFromSuggestions(name)
    + selectDatesFromNextFriday()
    + SelectOccupancy(rooms, adults, children)
    + clickSearchButton()
    + switchToSearchResultsTab()
    + waitForSearchResultsToLoad()
    + sortByLowestPrice()
    + getHotelListSize() : int
    + getAllHotelsFromListViewSearch(n) : List<Hotel>
    + verifySearchResultsDisplayed(n) : boolean
    + verifyHotelsSortedByLowestPrice(hotels) : boolean
    + verifyHotelsDestination(hotels, dest) : boolean
    + extractHotelFromCard(element) : Hotel
  }
}

package "Controls" {
  class BaseControl {
    - locator : String
    - byLocator : By
    - dynamicLocator : String
    - parent : BaseControl
    + getText() : String
    + enterText(text: String)
    + getChildElement(xpath: String) : WebElement
    + getChildElements(xpath: String) : List<WebElement>
    + isVisible() : boolean
    + isEnabled() : boolean
    + moveMouseByOffset(x, y)
    + scrollToView()
    + waitForVisibility([timeout])
    + waitForElementClickable([timeout])
  }

  class Element {
    + getText() : String
    + click()
    + waitForElementClickable([timeout])
    + getChildElements(xpath: String) : List<WebElement>
  }

  package "Utils (control/util)" {
    class DriverUtils {
      + getWebDriver() : WebDriver
      + getDriver() : WebDriver
      + execJavaScript(script, ...args)
      + getCurrentUrl() : String
      + navigateTo(url: String)
      + switchToWindow(index)
      + waitForNewWindowOpened(n)
      + waitForUrlContains(sub, timeout)
      + delay(seconds: double)
      + refresh()
      + deleteCookie()
      + moveMouseByOffset(x, y)
      + openNewTab()
      + waitForAjax()
      + waitForAngularReady()
      + setWindowSize(width, height)
      ...
    }
  }
}

package "Models" {
  class Hotel {
    + name : String
    + rating : String
    + location : String
    + price : String
    + badges : String[]
    + amenities : String[]
    + getName() : String
    + getPrice() : String
    + getLocation() : String
  }
}

package "Driver & Config" {
  abstract class DriverManager {
    # driver : WebDriver
    # browserType : BrowserType
    + getInstance(browserType) : DriverManager
    + getDriver() : WebDriver
    + initializeDriver(browserType)
    + quitWebDriver(browserType)
    + createWebDriver() : WebDriver
    # initLocalDriver()
    # initRemoteDriver()
  }

  class Chrome {
    # initLocalDriver()
    + initDriver()
  }

  class Firefox {
    # initLocalDriver()
    + initDriver()
  }

  class Edge {
    # initLocalDriver()
    + initDriver()
  }

  class Config {
    + getBrowserType() : BrowserType
    + getBaseUrl() : String
    + isRemoteEnabled() : boolean
    + isGridEnabled() : boolean
    + shouldSkipBrowser() : boolean
    + setThreadBrowser(browser: String)
    + getEnvFile() : String
  }

  enum BrowserType {
    CHROME
    FIREFOX
    EDGE
  }

  enum PlatformType {
    PC_WEB
    MOBILE_WEB
  }

  enum PlatformOS {
    WINDOWS
    LINUX
    MACOS
  }
}

package "Reporting" {
  class ReportManager {
    - reporterInstance : ITestReporter
    - strategyInstance : ReportStrategy
    + getReporter() : ITestReporter
    + selectStrategy() : ReportStrategy
    + reset()
  }

  interface ITestReporter {
    + logStep(message: String)
    + info(message: String)
    + logFail(message: String, error: Throwable)
    + attachScreenshot(name: String)
    + childStep(name: String, runnable: Runnable)
    + childStep(name: String, supplier: Supplier<T>) : T
  }

  interface ReportStrategy {
    + onStart(context: ITestContext)
    + onFinish(context: ITestContext)
    + onTestStart(result: ITestResult)
    + onTestSuccess(result: ITestResult)
    + onTestFailure(result: ITestResult)
    + onTestSkipped(result: ITestResult)
    + onConfigurationSuccess(result: ITestResult)
    + onConfigurationFailure(result: ITestResult)
    + failStep(name: String)
  }

  class ReportHook {
    - delegate : ReportStrategy
    + onTestStart(result)
    + onTestSuccess(result)
    + onTestFailure(result)
    + onTestSkipped(result)
    + onConfigurationSuccess(result)
    + onConfigurationFailure(result)
  }

  class AllureStrategy {
    + onStart(context)
    + onTestStart(result)
    + onTestSuccess(result)
    + onTestFailure(result)
    + onConfigurationSuccess(result)
    + failStep(name)
    - captureScreenshotOnFailure(result, type)
  }

  class ExtentStrategy {
    + onStart(context)
    + onTestStart(result)
    + onTestSuccess(result)
    + onTestFailure(result)
    + onConfigurationSuccess(result)
    - getTestForConfiguration(result) : ExtentTest
  }

  class JenkinsStrategy {
    + onStart(context)
    + onTestStart(result)
    + onTestSuccess(result)
    + onTestFailure(result)
    + failStep(name)
  }

  class AllureTestReporter {
    + logStep(message)
    + info(message)
    + logFail(message, error)
    + attachScreenshot(name)
    + childStep(name, runnable)
    + childStep(name, supplier) : T
  }

  class ExtentTestReporter {
    + logStep(message)
    + info(message)
    + logFail(message, error)
    + attachScreenshot(name)
    + childStep(name, runnable)
    + childStep(name, supplier) : T
    - getCurrentTest() : ExtentTest
    + setTest(test: ExtentTest)
    + clearTest()
  }

  class JenkinsTestReporter {
    + logStep(message)
    + info(message)
    + logFail(message, error)
    + attachScreenshot(name)
    + childStep(name, runnable)
    + childStep(name, supplier) : T
  }

  class Step <<annotation>> {
    + value() : String
  }

  class StepAspect {
    + aroundStep(joinPoint) : Object
    - buildMessage(step, method, args) : String
  }

  class ConsoleConfig {
    + startTerminalLog()
    + stopTerminalLog()
  }

  class SoftAssertConfig {
    + reset()
    + assertTrue(condition, message)
    + assertAll()
  }

  class FailureTracker {
    + isHandledForCurrentThread() : boolean
    + markHandledForCurrentThread()
    + clearForCurrentThread()
  }

  enum ReportType {
    ALLURE
    EXTENT
    JENKINS
  }

  note right of AllureStrategy
    Handles Allure report lifecycle.
    Relies on AllureTestNg listener
    (external) to create test cases.
  end note

  note right of ExtentStrategy
  Handles Extent report lifecycle.
  Relies on ExtentTestNg listener
  (external) to create test cases.
  end note

   note right of JenkinsStrategy
    Handles Jenkins report lifecycle.
    Integrates with Jenkins plugins
    for reporting.
   end note

  note right of StepAspect
    AspectJ AOP aspect that intercepts
    @Step annotations and creates steps
    via ITestReporter.childStep()
  end note
}

package "Utils (global)" {
  class Constants {
    + getBrowsers() : List<String>
    + getBaseUrl() : String
    + loadEnvironment(envFile: String)
  }

  class DateUtils {
    + getNextFriday() : LocalDate
    + getDateAfterDays(date: LocalDate, days: int) : LocalDate
  }

  class FormatUtils {
    + formatPrice(price: String) : double
    + parseDouble(value: String) : double
  }

  class JsonHelper {
    + getJsonObject(filePath: String) : JsonObject
    + getString(data: JsonObject, path: String) : String
    + getInt(data: JsonObject, path: String) : int
    + getListData(data: JsonObject, path: String) : List<JsonObject>
  }
}

package "Data Provider" {
  class DataProvider {
    + auto(method: Method) : Iterator<Object[]>
    + loadData(testCaseKey: String, dataFile: String) : Iterator<Object[]>
    + getString(data: JsonObject, path: String, default)
    + getInt(data: JsonObject, path: String, default)
    + getBoolean(data: JsonObject, path: String, default)
    + getObject(data: JsonObject, path: String) : JsonObject
  }

  class DataFile <<annotation>> {
    + value() : String
  }

  class DataPath <<annotation>> {
    + value() : String
  }
}

package "Browser Config" {
  class TestNGXmlGenerator {
    + generate(envFile: String)
    + generateFromBrowsers(browsers: List<String>)
    - generateXmlContent(browsers: List<String>) : String
  }
}

' External Dependencies (shown for clarity)
class AllureTestNg <<external>> {
  + onTestStart(result)
  + onTestSuccess(result)
  + onTestFailure(result)
}

class ExtentTestNg <<external>> {
  + onTestStart(result)
  + onTestSuccess(result)
  + onTestFailure(result)
}

class JenkinsTestNg <<external>> {
  + onTestStart(result)
  + onTestSuccess(result)
  + onTestFailure(result)
}

' Relationships
TestBase <|.. TC01AgodaHotelSearch
BasePage <|-- AgodaHomePage

BaseControl <|-- Element

AgodaHomePage ..> Element : uses
AgodaHomePage ..> DriverUtils : uses
AgodaHomePage ..> Hotel : returns
AgodaHomePage ..> Step : <<@Step annotations>>

BasePage ..> DriverUtils : uses
BasePage ..> ITestReporter : uses
BaseControl ..> DriverUtils : uses

DriverManager <|-- Chrome
DriverManager <|-- Firefox
DriverManager <|-- Edge

TestBase ..> DriverManager : uses
TestBase ..> Config : uses
TestBase ..> ConsoleConfig : uses
TestBase ..> SoftAssertConfig : uses
TestBase ..> BrowserType : uses

Config ..> BrowserType : uses
Config ..> ReportType : uses

' Reporting relationships
ReportManager ..> ITestReporter : creates
ReportManager ..> ReportStrategy : creates
ReportManager ..> ReportType : uses

ReportStrategy <|.. AllureStrategy
ReportStrategy <|.. ExtentStrategy
ReportStrategy <|.. JenkinsStrategy

ITestReporter <|.. AllureTestReporter
ITestReporter <|.. ExtentTestReporter
ITestReporter <|.. JenkinsTestReporter

ReportHook ..> ReportManager : uses
ReportHook ..> ReportStrategy : delegates to

AllureStrategy ..> AllureTestReporter : uses (via ReportManager)
ExtentStrategy ..> ExtentTestReporter : uses (via ReportManager)
JenkinsStrategy ..> JenkinsTestReporter : uses (via ReportManager)

StepAspect ..> Step : intercepts
StepAspect ..> ITestReporter : uses (via ReportManager)
StepAspect ..> ReportManager : uses

BasePage ..> ReportManager : uses
AgodaHomePage ..> Step : <<@Step annotations>>

AllureStrategy ..> AllureTestNg : relies on (external listener)
AllureTestNg ..> AllureStrategy : complements
ExtentStrategy ..> ExtentTestNg : relies on (external listener)
JenkinsStrategy ..> JenkinsTestNg : relies on (external listener)



' Data-driven relationships
TC01AgodaHotelSearch ..> DataProvider : <<dataProvider=auto>>
TC01AgodaHotelSearch ..> DataFile : <<annotation>>
TC01AgodaHotelSearch ..> DataPath : <<annotation on parameters>>
DataProvider ..> JsonHelper : uses

' Utils relationships
AgodaHomePage ..> Constants : uses
AgodaHomePage ..> DateUtils : uses
AgodaHomePage ..> FormatUtils : uses
TestBase ..> Constants : uses
DataProvider ..> JsonHelper : uses

' Browser Config
TestNGXmlGenerator ..> Constants : uses
TestNGXmlGenerator ..> Config : uses

note right of Reporting
  Reporting Architecture:
  1. ReportHook (TestNG listener) delegates to ReportStrategy
  2. AllureTestNg (external) creates Allure test cases
  3. StepAspect intercepts @Step and uses ITestReporter
  4. ReportManager selects strategy/reporter based on ReportType
end note

@enduml
